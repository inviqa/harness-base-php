{{- with $.Values.services.webapp }}
{{- if and .enabled $.Values.global.prometheus.podMonitoring -}}
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  name: {{ $.Release.Name }}-webapp
  labels:
    {{- include "chart.labels" $ | nindent 4 }}
    app.kubernetes.io/component: webapp
    app.service: {{ $.Release.Name }}-webapp
spec:
  selector:
    matchLabels:
      app.service: {{ $.Release.Name }}-webapp
  podMetricsEndpoints:
  {{- with $.Values.services.nginx -}}
  {{- if .metricsEnabled -}}
    {{ .metricsEndpoints | toYaml | nindent 6 -}}
  {{- end -}}
  {{- end -}}
  {{- with index $.Values.services "php-fpm-exporter" -}}
  {{- if and .enabled .metricsEnabled -}}
    {{ .metricsEndpoints | toYaml | nindent 6 -}}
  {{- end -}}
  {{- end -}}
{{- end -}}
{{- end -}}
