  solr:
{% if @('services.solr.major_version') == 4 %}
    build:
      context: .my127ws/docker/image/solr4/
      args:
        SOLR_CORE_NAME: collection1
{% else %}
    image: {{ @('services.solr.image') }}
{% endif %}
    environment:
      SOLR_CORE_NAME: collection1
    labels:
      - traefik.backend=solr-{{ @('workspace.name') }}
      - traefik.frontend.rule=Host:solr-{{ @('hostname') }}
      - traefik.docker.network=my127ws
      - traefik.port=8983
{% if @('services.solr.major_version') > 4 %}
    command:
      - solr-precreate
      - collection1
      - /opt/solr/server/solr/configsets/collection1
{% endif %}
    volumes:
{% if @('services.solr.major_version') == 4 %}
      - .my127ws/docker/image/solr4/root/usr/local/share/solr/collection1/conf/:/usr/local/share/solr/collection1/conf/
{% else %}
      - .my127ws/docker/image/solr/root/opt/solr/server/solr/configsets/collection1/conf:/opt/solr/server/solr/configsets/collection1/conf
{% endif %}
      - solr_data:/usr/local/share/solr/collection1/data/
    networks:
      - private
      - shared
