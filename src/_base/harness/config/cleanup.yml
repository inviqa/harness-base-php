function('built_images', [services]): |
  #!php
  $builtImages = [];

  foreach ($services as $service) {
    if ($service['image'] && count($service['upstream']) > 0) {
      $builtImages[] = $service['image'];
    }
  }

  # workspace commands don't allow non-string types
  = join(' ', $builtImages);

command('cleanup built-images'):
  env:
    IMAGES: = built_images(docker_service_images())
  exec: |
    #!bash
    IMAGES=($IMAGES)
    docker image rm --force -- "${IMAGES[@]}"
